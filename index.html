<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Estádio Virtual Interativo</title>

  <!-- A-FRAME -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@7.6.1/dist/aframe-extras.min.js"></script>
  <script src="https://unpkg.com/aframe-troika-text/dist/aframe-troika-text.min.js"></script>

  <link rel="stylesheet" href="css/ui.css" />
</head>

<body>
  <div id="posicao" style="display: none;">x:0, y:0, z:0</div>

  <a-scene background="color: #87CEEB" day-night-system="initialMode: day">

    <a-assets>
      <a-asset-item id="stadium" src="assets/stadium.glb"></a-asset-item>
      <img id="placar-textura" src="assets/placar.jpg">
      <a-asset-item id="chair" src="assets/chair.glb"></a-asset-item>
      <a-asset-item id="auditorium-model" src="assets/auditorio.glb"></a-asset-item>
      <a-asset-item id="human" src="assets/persona_formal.glb"></a-asset-item>
      <a-asset-item id="football_ball" src="assets/football_ball.glb"></a-asset-item>
      <audio id="kick-sound" src="assets/sounds/soccer-ball-kick.mp3"></audio>
      <audio id="goal-sound" src="assets/sounds/goal.mp3"></audio>
      <audio id="cantico-audio" src="assets/sounds/HinoBenfica.mp3"></audio>
    </a-assets>

    <!-- Modelo do Estádio -->
    <a-entity
      gltf-model="#stadium"
      position="0 1.5 0"
      rotation="0 0 0"
      scale="15 15 15">
    </a-entity>

    <!-- Modelo da bola -->
    <a-entity 
      id="ball"
      gltf-model="#football_ball" 
      position="0 6.95 0.2" 
      scale="0.005 0.005 0.005">
    </a-entity>

    <!-- Container para paredes -->
    <a-entity id="walls-container"></a-entity>

    <!-- Container para cadeiras (geradas dinamicamente) -->
    <a-entity id="chairs-container"></a-entity>

    <!-- Botão de entrada no estadio -->
    <a-entity id="teleport-button" position="0 2.8 48.5">
      <a-box
        class="clickable"
        width="1"
        height="2"
        depth="0.5"
        position="0 -0.5 0"
        material="opacity: 0; transparent: true"
        data-target-x="0"
        data-target-y="6.5"
        data-target-z="0"
        data-destination="stadium">
      </a-box>

      <a-entity 
        gltf-model="#human" 
        position="0 0.4 0" 
        rotation="0 0 0" 
        scale="10 10 10">
      </a-entity>

      <a-plane
        width="6.2"
        height="1.3"
        position="0 1.4 -0.05"
        material="color: #000000; opacity: 0.55; transparent: true"
        radius="0.15">
      </a-plane>

      <a-entity
        troika-text="
          value: Entrar no estádio;
          fontSize: 0.6;
          align: center;
          color: #FFFFFF;
        "
        position="0 1.6 0">
      </a-entity>

      <a-entity
        troika-text="
          value: Olhe por 2 segundos;
          fontSize: 0.32;
          align: center;
          color: #DDDDDD;
        "
        position="0 1.2 0">
      </a-entity>
    </a-entity>

    <!-- Botão de saida do estadio -->
    <a-entity position="9 8.7 0.3" rotation="0 -90 0">
      <a-box
        class="clickable"
        width="1"
        height="2"
        depth="0.5"
        position="0 -0.5 0"
        material="opacity: 0; transparent: true"
        data-target-x="4"
        data-target-y="1"
        data-target-z="52"
        data-destination="outside">
      </a-box>

      <a-entity 
        gltf-model="#human"
        position="0 0.4 0"
        scale="12 12 12">
      </a-entity>

      <a-plane
        width="3"
        height="0.7"
        position="0 1.3 -0.05"  
        material="color: #000000; opacity: 0.7"
        radius="0.1">
      </a-plane>

      <!-- TEXTO CENTRADO -->
      <a-entity
        troika-text="
          value: Sair do Estádio;
          fontSize: 0.35;
          align: center;
          color: #FFFFFF;
          anchor: center;
          baseline: center;"
        position="0 1.3 0">
      </a-entity>
    </a-entity>

    <!-- Placa Sala de Imprensa -->
    <a-entity position="12 1.5 46" rotation="0 5 0">
      <a-cylinder 
        position="0 0.25 0"    
        radius="0.07" 
        height="1.5" 
        color="#555555"
      ></a-cylinder>

      <a-entity position="0 1.5 0"> 
        <a-box 
          width="2.7" 
          height="1" 
          depth="0.1" 
          color="#222222" 
          opacity="0.9"
          position="0 0 0">
        </a-box>
        <a-entity position="0.2 0 0.11"> 
          <a-triangle
            vertex-a="0.2 0.25 0"
            vertex-b="0.2 -0.25 0"
            vertex-c="0.7 0 0"
            color="#ffffff"
          ></a-triangle>
          <a-entity 
            position="-0.15 0 0" 
            troika-text="
              value: Sala de Imprensa;
              fontSize: 0.25;
              color: #ffffff;
              align: left;
              maxWidth: 2;">
          </a-entity>
        </a-entity>
      </a-entity>
    </a-entity>
    
    <!-- Botão de entrada no auditorio -->
    <a-entity position="35 2.8 10">
      <a-box
        class="clickable"
        width="1"
        height="2"
        depth="0.5"
        position="0 -0.5 0"
        material="opacity: 0; transparent: true"
        data-target-x="84.58"
        data-target-y="1"
        data-target-z="-87"
        data-destination="auditorium">
      </a-box>

      <a-entity 
        gltf-model="#human"
        position="0 0.4 0"
        scale="10 10 10">
      </a-entity>

      <a-entity
        troika-text="
          value: Sala de Imprensa;
          fontSize: 0.35;
          align: center;
          color: #FFFFFF;"
        position="0 1.1 0">
      </a-entity>
    </a-entity>

    <a-entity id="auditorium-container" visible="false">
      <!-- Modelo do Auditorio -->
      <a-entity 
        id="auditorium"
        gltf-model="#auditorium-model" 
        position="92 0 -92" 
        rotation="0 0 0" 
        scale="2 2 2">
      </a-entity>

      <!-- Botão de saida no auditorio -->
      <a-entity position="84.5 2.6 -85.84" rotation="0 180 0">

        <a-box
          class="clickable"
          width="1"
          height="2"
          depth="0.5"
          position="0 -0.5 0"
          material="opacity: 0; transparent: true"
          data-target-x="37"
          data-target-y="1"
          data-target-z="16"
          data-destination="outside">
        </a-box>

        <a-entity 
          gltf-model="#human"
          position="0 0.4 0"
          scale="14 14 14">
        </a-entity>

        <a-plane
          width="3"
          height="0.7"
          position="0 1.3 -0.05"  
          material="color: #000000; opacity: 0.7"
          radius="0.1">
        </a-plane>

        <!-- TEXTO CENTRADO -->
        <a-entity
          troika-text="
            value: Sair do Auditório;
            fontSize: 0.35;
            align: center;
            color: #FFFFFF;
            anchor: center;
            baseline: center;"
          position="0 1.3 0">
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- Placar com imagem (no mundo) -->
    <a-plane
      position="-0.975 16.8 -28.5"
      rotation="18 0 0"
      width="5.25"
      height="4.125"
      material="src: #placar-textura; transparent: true">
    </a-plane>

    <!-- ========================= -->
    <!--          POIs             -->
    <!-- ========================= -->

    <!-- POI: Placar -->
    <a-sphere id="poi-placar" class="clickable"
      position="-0.975 14 -26"
      radius="0.35"
      material="color: #4CAF50"
      poi="title: Placar;
          text: Este é o placar principal. Aqui são mostrados o resultado e o tempo de jogo.">
    </a-sphere>

    <!-- POI: Bancada -->
    <a-sphere id="poi-bancada" class="clickable"
      position="-11 12 0"
      radius="0.35"
      material="color: #4CAF50"
      poi="title: Bancada Central;
          text: A bancada central oferece a melhor visibilidade do relvado e acesso às zonas VIP.">
    </a-sphere>

    <!-- POI: Relvado -->
    <a-sphere id="poi-relvado" class="clickable"
      position="0 9 0"
      radius="0.35"
      material="color: #4CAF50"
      poi="title: Relvado;
          text: Zona central do jogo. Aqui decorrem as principais ações da partida.">
    </a-sphere>

    <!-- POI: Cântico -->
    <a-sphere id="poi-cantico" class="clickable"
      position="8 10 -10"
      radius="0.35"
      material="color: #4CAF50"
      poi="title: Cântico dos Adeptos;
          text: Os cânticos dos adeptos refletem a paixão e a tradição do clube.;
          audio: #cantico-audio">
    </a-sphere>

    <!-- Chão -->
    <a-plane rotation="-90 0 0" width="200" height="200" color="#228B22"></a-plane>

    <!-- Luz solar -->
    <a-entity
      id="sunLight"
      light="type: directional; color: #ffffff; intensity: 2;"
      position="30 50 30"
      rotation="-45 45 0">
    </a-entity>

    <a-sphere
      id="sun"
      radius="4"
      position="50 60 50"
      material="color: #FFD700; emissive: #FFD700; emissiveIntensity: 1">
    </a-sphere>

    <!-- Lua -->
    <a-sphere
      id="moon"
      radius="3"
      position="-50 60 -50"
      visible="false"
      material="color: #ddddff; emissive: #ccccff; emissiveIntensity: 0.7">
    </a-sphere>

    <!-- Luzes noturnas -->
    <a-entity
      id="lamp-left"
      position="-13 20 0"
      rotation="-90 0 0"
      light="type: spot; color: #ffffff; intensity: 70; distance: 50; angle: 170; decay: 1.5;"
      look-at="0 0 0"
      visible="false">
    </a-entity>

    <a-entity
      id="lamp-right"
      position="13 20 0"
      rotation="-90 0 0"
      light="type: spot; color: #ffffff; intensity: 70; distance: 50; angle: 170; decay: 1.5;"
      look-at="0 0 0"
      visible="false">
    </a-entity>

    <!-- Luz ambiente -->
    <a-entity light="type: ambient; color: #ffffff; intensity: 0.5"></a-entity>

    <!-- ========================= -->
    <!--   PAINEL POI (NO MUNDO)   -->
    <!-- ========================= -->
    <a-entity id="poi-panel" position="0 0 0" visible="false">

      <!-- Fundo -->
      <a-plane id="poi-bg"
        width="2.4" height="1.3"
        material="color: #000; opacity: 0.90; transparent: true">
      </a-plane>

      <!-- Título -->
      <a-entity id="poi-title"
        position="0 0.55 0.02"
        troika-text="
          value: Título;
          fontSize: 0.20;
          color: #ffffff;
          maxWidth: 2.2;">
      </a-entity>

      <!-- Texto -->
      <a-entity id="poi-text"
        position="-0.05 0.15 0.02"
        troika-text="
          value: Texto;
          fontSize: 0.14;
          color: #e6e6e6;
          maxWidth: 2.2;
          lineHeight: 1.4;">
      </a-entity>

      <!-- BOTÃO FECHAR -->
      <a-plane id="poi-close"
        class="poi-ui clickable"
        position="0 -0.30 0.03"
        width="0.90" height="0.22"
        material="color: #cc0000; opacity: 0.98; transparent: true">
        <a-entity position="0 0 0.01"
          troika-text="
            value: FECHAR;
            fontSize: 0.14;
            align: center;
            color: #ffffff;">
        </a-entity>
      </a-plane>

    </a-entity>
    <!-- ========================= -->

    <!-- ========================= -->
    <!--      RIG + CÂMARA         -->
    <!-- ========================= -->
    <a-entity id="rig" position="-1 1 60">
      <a-camera id="camera" wasd-controls look-controls>

        <!-- Cursor -->
        <a-cursor
          fuse="true"
          fuse-timeout="2000"
          raycaster="objects: .clickable"
          material="color: white">
          <a-ring id="cursor-progress"
            radius-inner="0.02"
            radius-outer="0.03"
            theta-length="0"
            material="color: #00ff00">
          </a-ring>
        </a-cursor>

      </a-camera>
    </a-entity>
  </a-scene>

  <button class="btn-toggle" onclick="toggleControls()">❓Ajuda</button>

  <div id="controls-help">
    <h4>Controlos</h4>
    <ul>
      <li><strong>Rato:</strong> Olhar à volta</li>
      <li><strong>WASD:</strong> Andar</li>
      <li><strong>Shift:</strong> Correr</li>
      <li><strong>Olhar:</strong> Mantém o olhar nas esferas/pessoas por 2 segundos</li>
      <li><strong>Espaço:</strong> Chutar a bola</li>
      <li><strong>V:</strong> Ativar/Desativar controlo por voz</li>
      <li><strong>M:</strong> Alternar modo dia/noite</li>
      <li><strong>T:</strong> Iniciar visita guiada</li>
      <li><strong>ESC:</strong> Fechar painéis informativos</li>
    </ul>
  </div>
  
  <!-- Scripts -->
  <script src="js/day-night.js"></script>
  <script src="js/walls.js"></script>
  <script src="js/chairs.js"></script>
  <script src="js/cursor.js"></script>
  <script src="js/teleport.js"></script>
  <script src="js/auditorium.js"></script>
  <script src="js/ball.js"></script>
  <script src="js/movement.js"></script>
  <script src="js/collision.js"></script>
  <script src="js/poi.js"></script>
  <script src="js/voice-control.js"></script>
  <script src="js/guided-tour.js"></script>
  <script src="js/main.js"></script>
</body>
</html>